name: Runner
on: [ push, pull_request ]

jobs:
    static-checks:
        name: ğŸ“Š é™æ€æ£€æŸ¥
        uses: ./.github/workflows/static-check.yml
    
    clang-format:
        name: ä»£ç æ ¼å¼åŒ–
        permissions:
            actions: read
            checks: read
            contents: write
        needs: static-checks
        if: ${{ success() && needs.static-checks.outputs.exit_code != 0 }}
        uses: ./.github/workflows/clang-format.yml

    check-commit-release:
        name: æ£€æŸ¥æ˜¯å¦ä¸ºå‘å¸ƒçŠ¶æ€
        if: always()
        runs-on: ubuntu-latest
        steps:
            - name: æ£€æŸ¥ Commit ä¿¡æ¯
              id: check_commit_msg
              run: |
                echo "release=${{ contains(github.event.head_commit.message, '[Release]') || contains(github.event.head_commit.message, '[All]') || github.event_name == 'pull_request' }}" >> $GITHUB_ENV
            - name: è¾“å‡ºç»“æœ
              run: |
                echo "true æ—¶æ‰“å¼€ release, false æ—¶ä»…è¿è¡Œ debug"
                echo ${{ contains(github.event.head_commit.message, '[Release]') || contains(github.event.head_commit.message, '[All]') || github.event_name == 'pull_request' }}

    cmake_matrix_debug:
        name: CMake çŸ©é˜µç¼–è¯‘ (Debug)
        needs: [clang-format, static-checks]
        if: ${{ (success() || needs.clang-format.result == 'skipped' || needs.clang-format.result == 'success') && needs.static-checks.result == 'success' }}
        uses: ./.github/workflows/cmake-matrix-debug.yml
    
    cmake_matrix_release:
        name: CMake çŸ©é˜µç¼–è¯‘ (Release)
        needs: [clang-format, static-checks, check-commit-release]
        if: ${{ (success() || needs.clang-format.result == 'skipped' || needs.clang-format.result == 'success') && needs.static-checks.result == 'success' && (needs.check-commit-release.outputs.release == 'true' || needs.check-commit-release.outputs.release == true || needs.check-commit-release.outputs.release == 1) }}
        uses: ./.github/workflows/cmake-matrix-release.yml