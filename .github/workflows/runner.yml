name: Runner
on: [ push, pull_request ]

jobs:
    static-checks:
        if: !github.event.pull_request
        name: 📊 静态检查
        uses: ./.github/workflows/static-check.yml
        with:
            trigger_condition: ${{ github.event_name }}
            pr_id: ${{ -1 }}
    static-checks-only:
        if: github.event.pull_request
        name: 📊 静态检查 (PR)
        uses: ./.github/workflows/static-check.yml
        with:
            trigger_condition: ${{ github.event_name }}
            # pr_id: ${{  github.event.pull_request.number }}
            pr_id: ${{ github.event.pull_request }}
    clang-format:
        name: 代码格式化
        permissions:
            actions: read
            checks: read
            contents: write
            pull-requests: write
        needs: static-checks
        if: ${{ success() && needs.static-checks.outputs.exit_code != 0 }}
        uses: ./.github/workflows/clang-format.yml

    cmake_matrix:
        name: CMake 矩阵编译
        needs: [clang-format, static-checks]
        if: ${{ (success() || needs.clang-format.result == 'skipped' || needs.clang-format.result == 'success') && needs.static-checks.result == 'success' }}
        uses: ./.github/workflows/cmake-matrix.yml